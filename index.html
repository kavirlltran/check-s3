<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kiểm Tra Phát Âm với Web Speech API</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
    }
    .sentence-container {
      margin-bottom: 30px;
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .sentence {
      font-size: 1.2em;
      margin-bottom: 10px;
    }
    .result {
      margin-top: 10px;
      font-weight: bold;
    }
    button {
      padding: 10px 15px;
      font-size: 1em;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Kiểm Tra Phát Âm</h1>
  <p>
    Hãy đọc to các câu sau. Các từ có dấu <code>'</code> (hoặc <code>‘</code>) đánh dấu trọng âm.
    Nhấn nút <strong>Record</strong> để kiểm tra phát âm của bạn.
  </p>
  
  <div id="sentences"></div>
  
  <script>
    // Danh sách các câu (các dấu ' hoặc ‘ đánh dấu trọng âm)
    const sentences = [
      "We should ‘finish the ‘project for our ‘history ‘class",
      "‘Peter is re‘vising for his e‘xam ‘next ‘week.",
      "‘Students will ‘spend more ‘time ‘working with ‘other ‘classmates.",
      "I ‘like to ‘watch ‘videos that ‘help me ‘learn ‘new ‘things",
      "I have ‘installed some ‘apps on my ‘phone"
    ];

    // Hàm loại bỏ dấu nhấn (dấu ' và ‘ ’)
    function removeStressMarkers(text) {
      return text.replace(/['‘’]/g, "");
    }

    const sentencesDiv = document.getElementById("sentences");

    // Kiểm tra sự hỗ trợ của Web Speech API
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("Trình duyệt của bạn không hỗ trợ Speech Recognition API. Vui lòng thử trên Chrome hoặc Edge.");
    }

    // Tạo giao diện cho từng câu
    sentences.forEach((sentence, index) => {
      // Tạo container cho từng câu
      const container = document.createElement("div");
      container.className = "sentence-container";
      container.id = "sentence-container-" + index;
      
      // Hiển thị câu
      const sentenceEl = document.createElement("div");
      sentenceEl.className = "sentence";
      sentenceEl.textContent = sentence;
      container.appendChild(sentenceEl);
      
      // Nút Record
      const recordBtn = document.createElement("button");
      recordBtn.textContent = "Record";
      recordBtn.id = "record-btn-" + index;
      container.appendChild(recordBtn);
      
      // Vùng hiển thị kết quả
      const resultDiv = document.createElement("div");
      resultDiv.className = "result";
      resultDiv.id = "result-" + index;
      container.appendChild(resultDiv);
      
      sentencesDiv.appendChild(container);
      
      // Sự kiện khi nhấn nút Record
      recordBtn.addEventListener("click", () => {
        resultDiv.textContent = "Listening...";
        startRecognition(index, sentence, resultDiv);
      });
    });

    // Hàm sử dụng Web Speech API để nhận dạng giọng nói
    function startRecognition(index, sentence, resultDiv) {
      const recognition = new SpeechRecognition();
      recognition.lang = "en-US";
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      
      recognition.start();

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        const cleanSentence = removeStressMarkers(sentence).toLowerCase().trim();
        const cleanTranscript = transcript.toLowerCase().trim();

        let feedback = `Bạn nói: "${transcript}"`;
        if (cleanTranscript === cleanSentence) {
          feedback += " - Tuyệt vời!";
        } else {
          feedback += " - Hãy thử lại.";
        }
        resultDiv.textContent = feedback;
      };

      recognition.onerror = function(event) {
        resultDiv.textContent = "Lỗi: " + event.error;
      };

      recognition.onend = function() {
        // Nhận dạng kết thúc, có thể cập nhật giao diện nếu cần
      };
    }
  </script>
</body>
</html>
